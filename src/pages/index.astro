---
import { getCollection, getEntry } from 'astro:content';
import type { PostEntry, HeroEntry } from '../types/content';
import Layout from '../layouts/Layout.astro';
import { StyledEngineProvider } from '@mui/material';
import Theme from '../theme/Theme.tsx'
import Blog from '../components/blog/Blog';

// Get hero content with proper typing - try main first, then get the first available entry
let heroData: HeroEntry | undefined;
try {
  heroData = await getEntry('hero', 'main');
} catch (error) {
  const allHero: HeroEntry[] = await getCollection('hero');
  heroData = allHero?.[0];
}

// Fetch all blog posts with proper typing
const posts: PostEntry[] = await getCollection('posts');

console.log({posts})
---

<Layout>
  <StyledEngineProvider injectFirst client:load>
    <Theme>
      <Blog />
    </Theme>
  </StyledEngineProvider>

</Layout>

<!-- Netlify Identity widget for password recovery -->
<script src="https://cdn.jsdelivr.net/npm/netlify-identity-widget@1.9.1/build/netlify-identity-widget.min.js" defer></script>
<script is:inline>
  if (window.netlifyIdentity) {
    window.netlifyIdentity.init();
  }
</script>