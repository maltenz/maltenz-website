---
import { getCollection, getEntry } from 'astro:content';
import type { ProjectEntry, HeroEntry } from '../types/content';
import Layout from '../layouts/Layout.astro';
import Hero from '../components/Hero/index.tsx';

// Get hero content with proper typing - try main first, then get the first available entry
let heroData: HeroEntry | undefined;
try {
  heroData = await getEntry('hero', 'main');
} catch (error) {
  const allHero: HeroEntry[] = await getCollection('hero');
  heroData = allHero?.[0];
}

// Fetch all blog posts with proper typing
const posts: ProjectEntry[] = await getCollection('projects');
---
  <script is:inline>
    // Run immediately to catch hash before Identity widget does
    const { hash } = window.location;
    if (hash.includes('recovery_token') || hash.includes('invite_token')) {
      window.location.replace(`/admin/${hash}`);
    }
  </script>
<Layout>
  {heroData?.data && <Hero data={heroData.data} client:load />}
  <!-- {posts.length && (
    <Blog data={posts} />
  )} -->
</Layout>

