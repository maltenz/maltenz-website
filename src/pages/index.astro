---
import { getCollection, getEntry } from 'astro:content';
import Hero from '../components/Hero.tsx';
import Post from '../components/Post.tsx';
import MuiThemeProvider from '../components/MuiThemeProvider.tsx';
import Layout from '../layouts/Layout.astro';
import { StyledEngineProvider } from '@mui/material';

// Get hero content - try main first, then get the first available entry
let heroData;
try {
  heroData = await getEntry('hero', 'main');
} catch (error) {
  const allHero = await getCollection('hero');
  heroData = allHero?.[0];
}

// Fetch all blog posts
const posts = await getCollection('posts');
---

<Layout>
	<StyledEngineProvider injectFirst>
		<MuiThemeProvider client:load>
			<Hero 
				client:load
				title={heroData?.data?.title || "Welcome to My Portfolio"}
				subtitle={heroData?.data?.subtitle || "Full-Stack Developer & UI/UX Enthusiast"}
				description={heroData?.data?.description || "I'm a full-stack developer passionate about creating amazing web experiences with modern technologies like React, TypeScript, and Astro."}
				ctaText={heroData?.data?.ctaText || "View My Work"}
				ctaLink={heroData?.data?.ctaLink || "#projects"}
			/>
		</MuiThemeProvider>
	</StyledEngineProvider>

	<section id="posts">
		<h2>Latest Posts</h2>
		<div class="posts-grid">
			{posts.map(post => (
			   <Post
				   client:load
				   title={post.data.title}
				   description={post.data.description}
				   publishDate={post.data.publishDate}
				   author={post.data.author}
				   tags={post.data.tags}
				   featured={post.data.featured}
				   slug={post.slug}
				   image={post.data.image}
			   />
			))}
		</div>
	</section>
</Layout>

<style>
	.posts-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
		gap: 24px;
		margin-top: 24px;
	}
</style>
